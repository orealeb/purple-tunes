<!DOCTYPE html>
<html lang="en">
<!-- start Mixpanel ><script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("30c286bf70939e9de7f46b3c58bf4e84");</script>< end Mixpanel -->
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<meta name="description" content="">
		<meta name="author" content="">
		<link rel="icon" href="favicon.ico">
    	<title>Purple Tunes</title>
		<!-- Bootstrap core CSS -->
		<link href="css/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css">
		<!-- Custom styles for this template -->
		<link href="css/jquery.bxslider.css" rel="stylesheet">
		<link href="css/style.css" rel="stylesheet">
		<script src="js/vendor/jquery.js"></script>
	    <script> 
	        //mixpanel.track("home page load page load");

	        $(function(){
	          $("#headerNavBar").load("headerNavBar.html"); 
	          $("#footer").load("footer.html"); 
	          $("#sidebar").load("sidebar.html");
	        });
	    </script> 
	</head>

	<body>
		
   <div id="headerNavBar"></div>

		<div class="container">
		<section>
			<div class="row">
				<div id="divID" class="col-md-8">
					
					

			</div>
            <div class="col-md-4 sidebar-gutter">
            	<div id="sidebar"></div>
            </div>
		</section>
		</div><!-- /.container -->



  <script type="text/javascript">
        function getParameterByName(name, callback) {
          var url = window.location.href;
          name = name.replace(/[\[\]]/g, "\\$&");
          var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),
              results = regex.exec(url);
          if (!results) return null;
          if (!results[2]) return '';
          return callback(decodeURIComponent(results[2].replace(/\+/g, " ")));
      }

            /***SECTION 2 : get Data from perl script***/
        function getNMusicData(id, callback) {

          console.log("get music page called");
            var requestData = "";              
            $.ajax({
                type: "POST",
                url: "https://purpletunez.herokuapp.com/api/article/get", // URL of the Perl script
                //dataType: 'json',
                data: {
                    "transactionID": id
                },

                // script call was *not* successful
                error: function() {
                    alert("script call was not successful");
                },

                // script call was successful 
                success: function(news_data) {
                    console.log(news_data);
                    //alert(news_data);
                   // requestData = perl_data;
                    //convert to 2d array
                   // var jsonData = JSON.parse("[" + requestData + "]");                   
                  return callback(news_data);
                }
            });         

        }

          var month = new Array();
          month[0] = "January";
          month[1] = "February";
          month[2] = "March";
          month[3] = "April";
          month[4] = "May";
          month[5] = "June";
          month[6] = "July";
          month[7] = "August";
          month[8] = "September";
          month[9] = "October";
          month[10] = "November";
          month[11] = "December";


        getParameterByName('id',  function(returnedID) {

          getNMusicData(returnedID,  function(data) {

                   var article=document.createElement("article");
                   article.setAttribute("class", "blog-post");
                   var newDate = new Date(data.date);
                   article.innerHTML = ("<div class='blog-post-image'><a href='#'>"+data.title+"<img src='"+data.imageURL+"''></a></div><div class='blog-post-body'><h2><a href='#'>"+data.title+"</a></h2><div class='post-meta'><span>by <a href='#''>"+data.author+"</a></span>/<span><i class='fa fa-clock-o'></i>" + month[newDate.getMonth()] + ' ' +  newDate.getDate() + ', ' +  newDate.getFullYear() +"</span>/<span><i class='fa fa-comment-o'></i> <a href='#'>343</a></span></div><div class='blog-post-text'>"+  data.text +"</div></div>");

                    var dataContainer = document.getElementById('divID');
                     dataContainer.appendChild(article);

                     var musicPlayer =  document.createElement("div");
                     dataContainer.setAttribute("class", "row");
                     dataContainer.setAttribute("style", "max-height: 140px");
                     musicPlayer.innerHTML  = ("<audio controls><source src='" + data.audioURL +"' type='audio/ogg'>Your browser does not support the audio element.</audio>");


                      //<iframe style='border:none' src='"+ data.audioURL +"' width='395' height='65' allowfullscreen='true' mozallowfullscreen='true' webkitallowfullscreen='true'></iframe>");
                     dataContainer.appendChild(musicPlayer);
        
          });

        });


						//<div class='blog-post-image'><a href='#'>"+data.title+"<img src='"+data.imageURL+"''></a></div><div class='blog-post-body'><h2><a href='#'>"+data.title+"</a></h2><div class='post-meta'><span>by <a href='#''>"+data.author+"</a></span>/<span><i class='fa fa-clock-o'></i>" + month[newDate.getMonth()] + ' ' +  newDate.getDate() + ', ' +  newDate.getFullYear() +"</span>/<span><i class='fa fa-comment-o'></i> <a href='#'>343</a></span></div><div class='blog-post-text'>"+  data.text +"</div></div>
	

      </script>


   		<div id="footer"></div>


		<!-- Bootstrap core JavaScript
			================================================== -->
		<!-- Placed at the end of the document so the pages load faster -->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/jquery.bxslider.js"></script>
		<script src="js/mooz.scripts.min.js"></script>
	</body>
</html>
